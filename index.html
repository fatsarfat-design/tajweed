<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–¢–∞–¥–∂–≤–∏–¥ ‚Äî —É—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
<link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#0b1220"/>
<style>
:root{
  color-scheme:dark;
  --bg:#070b14;
  --panel:#0f1a2f;
  --panel2:#0b1220;
  --border:#243042;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --gold:#d6b25e;
  --accent:#3b82f6;
  --radius:18px;
  --fs:16px;
  --arabic-size:1.25em;
  --arabic-font:"Amiri","Scheherazade New","Noto Naskh Arabic","Noto Sans Arabic","Arial";
  --ui-font:system-ui,Segoe UI,Roboto,Arial;
}
html,body{height:100%}
body{
  margin:0;
  font:var(--fs)/1.6 var(--ui-font);
  background:
    radial-gradient(900px 600px at 20% -10%, rgba(214,178,94,.18), transparent 60%),
    radial-gradient(900px 600px at 90% 10%, rgba(59,130,246,.14), transparent 55%),
    radial-gradient(800px 700px at 40% 120%, rgba(214,178,94,.10), transparent 60%),
    var(--bg);
  color:var(--text);
}
/* subtle arabesque pattern */
body:before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none;
  opacity:.08;
  background-image:
    radial-gradient(circle at 25px 25px, rgba(214,178,94,.9) 2px, transparent 3px),
    radial-gradient(circle at 75px 75px, rgba(214,178,94,.7) 1.5px, transparent 3px);
  background-size:100px 100px;
  mix-blend-mode:screen;
}
header{
  position:sticky; top:0; z-index:10;
  background:rgba(7,11,20,.86);
  backdrop-filter: blur(10px);
  border-bottom:1px solid rgba(36,48,66,.85);
}
.wrap{max-width:1080px;margin:0 auto;padding:16px}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
h1{margin:0;font-size:20px;letter-spacing:.2px}
h2,h3{margin:0 0 10px}
.muted{color:var(--muted)}
.small{font-size:12px}
.right{margin-left:auto}
.pill{padding:5px 12px;border:1px solid var(--border);border-radius:999px;background:rgba(15,26,47,.35)}
.card{
  background:linear-gradient(180deg, rgba(15,26,47,.92), rgba(11,18,32,.92));
  border:1px solid rgba(36,48,66,.9);
  border-radius:var(--radius);
  padding:14px;
  margin:12px 0;
  box-shadow:0 14px 30px rgba(0,0,0,.22);
}
.hr{height:1px;background:rgba(36,48,66,.9);margin:12px 0}
button{
  border:1px solid rgba(43,58,82,.95);
  background:rgba(17,28,51,.85);
  color:var(--text);
  border-radius:14px;
  padding:10px 12px;
  cursor:pointer;
}
button.primary{background:rgba(31,42,68,.9);border-color:rgba(59,130,246,.65)}
button.gold{background:rgba(214,178,94,.12);border-color:rgba(214,178,94,.55)}
button.ghost{background:transparent}
input,select{
  width:100%; box-sizing:border-box;
  border:1px solid rgba(36,48,66,.95);
  background:rgba(11,18,32,.85);
  color:var(--text);
  border-radius:14px;
  padding:10px 12px;
}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:900px){.grid2{grid-template-columns:1fr}}
.list{display:grid;gap:10px}
.tag{
  display:inline-block;
  font-size:12px;
  color:#d1d5db;
  border:1px solid rgba(36,48,66,.95);
  border-radius:999px;
  padding:3px 10px;
  margin-right:6px;
  margin-top:6px;
  background:rgba(11,18,32,.65);
}
/* Diagrams */
.diagram{
  background:rgba(11,18,32,.8);
  border:1px solid rgba(36,48,66,.95);
  border-radius:16px;
  padding:12px;
  margin:10px 0;
}
.diagram .title{font-weight:900;margin-bottom:8px;color:#f3f4f6}
.flow{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.box{
  background:rgba(17,28,51,.9);
  border:1px solid rgba(36,48,66,.95);
  border-radius:14px;
  padding:10px 12px;
  min-width:200px;
}
.arrow{opacity:.85;color:rgba(214,178,94,.9)}
/* Arabic examples */
.ar{
  font-family:var(--arabic-font);
  font-size:var(--arabic-size);
  direction:rtl;
  unicode-bidi:isolate;
  letter-spacing:.2px;
}
.arline{
  padding:10px 12px;
  border:1px dashed rgba(214,178,94,.45);
  border-radius:14px;
  background:rgba(214,178,94,.06);
  margin:8px 0;
}
.hl{
  color:rgba(214,178,94,1);
  font-weight:900;
  text-shadow:0 0 14px rgba(214,178,94,.25);
}
/* Quiz */
.q{
  background:rgba(11,18,32,.85);
  border:1px solid rgba(36,48,66,.95);
  border-radius:16px;
  padding:12px;
  margin:10px 0;
}
.opt{display:flex;align-items:center;gap:10px;margin:8px 0}
.opt input{transform:scale(1.15)}
.good{color:#34d399}
.bad{color:#fb7185}
.notice{padding:10px 12px;border-radius:14px;border:1px solid rgba(36,48,66,.95);background:rgba(11,18,32,.85)}
kbd{border:1px solid rgba(36,48,66,.95);border-bottom-width:2px;border-radius:8px;padding:2px 7px;background:rgba(11,18,32,.75);font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;font-size:12px}
/* Settings drawer */
#settingsDrawer{
  position:fixed; top:0; right:0; height:100%; width:min(420px, 92vw);
  transform:translateX(105%);
  transition:transform .22s ease;
  z-index:50;
  background:rgba(7,11,20,.92);
  border-left:1px solid rgba(36,48,66,.95);
  backdrop-filter: blur(12px);
}
#settingsDrawer.open{transform:translateX(0)}

textarea{
  width:100%;
  min-height:120px;
  resize:vertical;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid var(--bd);
  background: rgba(255,255,255,0.04);
  color: var(--fg);
  outline:none;
}
textarea:focus{border-color: rgba(232, 200, 120, 0.65); box-shadow: 0 0 0 4px rgba(232,200,120,0.12);}
.opt{width:100%; justify-content:flex-start; gap:10px;}
.opt span{flex:1; text-align:left;}

:root{
  --bg-img: none;
  --bg-repeat: repeat;
  --bg-size: auto;
}
body::after{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events:none;
  background-image: var(--bg-img);
  background-repeat: var(--bg-repeat);
  background-size: var(--bg-size);
  opacity: 0.20;
  filter: saturate(1.05) contrast(1.02);
  z-index: 0;
}
.app{position:relative; z-index:1;}
</style>
</head>
<body>
<header>
  <div class="wrap row" style="justify-content:space-between">
    <div>
      <h1>–¢–∞–¥–∂–≤–∏–¥ ‚Äî —É—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
      <div class="muted small">–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ ¬∑ –ø—Ä–∏–º–µ—Ä—ã ¬∑ —Å—Ö–µ–º—ã ¬∑ —Ç–µ—Å—Ç—ã ¬∑ —ç–∫–∑–∞–º–µ–Ω—ã ¬∑ —Ç—Ä–µ–Ω–∞–∂—ë—Ä</div>
    </div>
    <div class="row">
      <span class="pill" id="progressPill">0/0</span>
      <button class="gold" id="settingsBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <button id="installBtn" class="primary" style="display:none">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    </div>
  </div>
</header>

<main class="wrap">
  <div id="viewHome">
    <div class="card">
      <div class="grid2">
        <div>
          <div class="muted small">–ü–æ–∏—Å–∫ –ø–æ —É—Ä–æ–∫–∞–º</div>
          <input id="q" placeholder="—Å—ã—Ñ–∞—Ç—ã, ÿ¥ÿØÿ©, –º–∞–¥–¥, –≤–∞–∫—Ñ‚Ä¶" />
        </div>
        <div>
          <div class="muted small">–§–∏–ª—å—Ç—Ä</div>
          <select id="blockFilter">
            <option value="all">–í—Å–µ</option>
            <option value="b1">–ë–ª–æ–∫ 1: –ú–∞—Ö—Ä–∞–¥–∂–∏</option>
            <option value="b2">–ë–ª–æ–∫ 2: –°—ã—Ñ–∞—Ç—ã</option>
            <option value="b3">–ë–ª–æ–∫ 3: –ù—É–Ω ÿ≥ÿß–∫–∏–Ω–∞</option>
            <option value="b4">–ë–ª–æ–∫ 4: –ú–∏–º ÿ≥ÿß–∫–∏–Ω–∞</option>
            <option value="b5">–ë–ª–æ–∫ 5: –ú–∞–¥–¥—ã</option>
            <option value="b6">–ë–ª–æ–∫ 6: –í–∞–∫—Ñ –∏ –∏–±—Ç–∏–¥–∞</option>
            <option value="trainer">–¢—Ä–µ–Ω–∞–∂—ë—Ä</option>
            <option value="exam">–≠–∫–∑–∞–º–µ–Ω—ã</option>
          </select>
        </div>
      </div>
      <div class="hr"></div>
      <div class="muted small">
        –ü–æ–¥—Å–∫–∞–∑–∫–∞: –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Ç–µ–º–∞–º–∏ –≤ —É—Ä–æ–∫–µ –∏—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ <kbd>‚Üê</kbd> / <kbd>‚Üí</kbd> (–∏–ª–∏ ¬´–ü—Ä–µ–¥.¬ª / ¬´–°–ª–µ–¥.¬ª).
      </div>
    </div>

    <div class="card">
      <h2>–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ</h2>
      <div class="muted">–°–µ–π—á–∞—Å –º—ã –æ–±–Ω–æ–≤–∏–ª–∏ –ë–ª–æ–∫ 2 (–°—ã—Ñ–∞—Ç—ã): –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è + –∞—Ä–∞–±—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã + –ø–æ–¥—Ä–æ–±–Ω–µ–µ.</div>
      <div class="hr"></div>
      <div id="lessonList" class="list"></div>
    </div>
  </div>

  <div id="viewLesson" style="display:none">
    <div class="card">
      <div class="row">
        <button onclick="goHome()">‚Üê –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ</button>
        <button class="ghost" id="prevBtn">‚Üê –ü—Ä–µ–¥.</button>
        <button class="ghost" id="nextBtn">–°–ª–µ–¥. ‚Üí</button>
        <span class="right"></span>
        <button id="btnDone" class="primary"></button>
      </div>
    </div>

    <div class="card">
      <h2 id="lessonTitle"></h2>
      <div class="muted small" id="lessonBadges"></div>
      <div class="hr"></div>
      <div id="lessonText" style="white-space:pre-wrap"></div>
      <div id="lessonExtras"></div>
      <div id="lessonDiagram"></div>

      <div class="hr"></div>
      <div class="muted" style="margin-bottom:8px">–ó–∞–º–µ—Ç–∫–∏ (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ)</div>
      <textarea id="notesArea" placeholder="–ü–∏—à–∏ —Å–≤–æ–∏ –∑–∞–º–µ—Ç–∫–∏ –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ‚Ä¶"></textarea>
      <div class="row mt">
        <button class="btn" id="clearNotesBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <div class="right muted" id="notesStatus">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>
      </div>
    </div>

    <div class="card" id="quizBlock" style="display:none"></div>
  </div>
</main>

<!-- Settings Drawer -->
<div id="settingsDrawer">
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <h2 style="margin:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <button class="ghost" id="closeSettings">‚úï</button>
    </div>
    <div class="muted small">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</div>
    <div class="hr"></div>

    <div class="card" style="margin:0 0 12px 0">
      <h3>–†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</h3>
      <div class="muted small">–û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–∑–º–µ—Ä</div>
      <input id="fsRange" type="range" min="14" max="22" step="1"/>
      <div class="muted small">–¢–µ–∫—É—â–∏–π: <span id="fsVal"></span> px</div>
      <div class="hr"></div>
      <div class="muted small">–†–∞–∑–º–µ—Ä –∞—Ä–∞–±—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞</div>
      <input id="arRange" type="range" min="1.05" max="1.85" step="0.05"/>
      <div class="muted small">–¢–µ–∫—É—â–∏–π: <span id="arVal"></span></div>
    </div>

    <div class="card" style="margin:0 0 12px 0">
      <h3>–®—Ä–∏—Ñ—Ç –∞—Ä–∞–±—Å–∫–æ–≥–æ</h3>
      <div class="muted small">–í—ã–±–∏—Ä–∞–π —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ª—É—á—à–µ —Å–º–æ—Ç—Ä–∏—Ç—Å—è –Ω–∞ —Ç–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</div>
      <select id="arFontSel">
        <option value='"Amiri","Scheherazade New","Noto Naskh Arabic","Noto Sans Arabic","Arial"'>Amiri / Scheherazade / Noto (—Ä–µ–∫–æ–º–µ–Ω–¥.)</option>
        <option value='"Noto Naskh Arabic","Noto Sans Arabic","Arial"'>Noto Naskh Arabic</option>
        <option value='"Scheherazade New","Noto Naskh Arabic","Arial"'>Scheherazade New</option>
        <option value='"Arial"'>Arial (–µ—Å–ª–∏ –¥—Ä—É–≥–∏—Ö –Ω–µ—Ç)</option>
      </select>
    </div>

    
    <div class="card" style="margin:0 0 12px 0">
      <h3>–§–æ–Ω –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
      <div class="muted small">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ñ–æ–Ω –∏–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç–∏–Ω–∫—É</div>
      <select id="bgSel">
        <option value="stars">–ó–≤—ë–∑–¥–Ω—ã–π —É–∑–æ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
        <option value="arabesque">–ê—Ä–∞–±–µ—Å–∫–∏ (—É–∑–æ—Ä)</option>
        <option value="paper">–¢—ë–ø–ª–∞—è –±—É–º–∞–≥–∞</option>
        <option value="custom">–°–≤–æ—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ</option>
      </select>
      <div class="mt" id="bgUrlWrap" style="display:none">
        <div class="muted small">–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (https://...)</div>
        <input id="bgUrl" type="text" placeholder="–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"/>
      </div>
    </div>

    <div class="card" style="margin:0 0 12px 0">
      <h3>–ó–∞–º–µ—Ç–∫–∏</h3>
      <div class="muted small">–ó–∞–º–µ—Ç–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</div>
      <div class="row mt">
        <button class="btn" id="exportNotes">–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–º–µ—Ç–æ–∫ (JSON)</button>
        <button class="btn" id="clearAllNotes">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
      </div>
      <div class="muted small mt" id="notesCount">‚Äî</div>
    </div>
    <div class="card" style="margin:0">
      <h3>–ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏</h3>
      <div class="row">
        <button class="primary" id="resetSettings">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </div>
    </div>
  </div>
</div>

<script>
// ==========================
// Content
// ==========================
const lessons = [
  {
    id: "b1_01",
    block: "b1",
    order: 1,
    title: "–ú–∞—Ö—Ä–∞–¥–∂: —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º",
    tags: ["–º–∞—Ö—Ä–∞–¥–∂", "–º–µ—Å—Ç–æ", "–±—É–∫–≤–∞"],
    text: `–ú–∞—Ö—Ä–∞–¥–∂ (ŸÖÿÆÿ±ÿ¨) ‚Äî –º–µ—Å—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–≤—ã—Ö–æ–¥–∞) –∑–≤—É–∫–∞ –±—É–∫–≤—ã.

–ß—Ç–æ–±—ã –±—É–∫–≤–∞ –∑–≤—É—á–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤–∞–∂–Ω–æ:
1) –≥–¥–µ –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –∑–≤—É–∫ (–º–∞—Ö—Ä–∞–¥–∂)
2) –∫–∞–∫ –æ–Ω –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—Å—è ‚Äî –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ (—Å—ã—Ñ–∞—Ç—ã).

–ó–æ–Ω—ã –º–∞—Ö—Ä–∞–¥–∂–µ–π: –ø–æ–ª–æ—Å—Ç—å —Ä—Ç–∞ (ÿßŸÑÿ¨ŸàŸÅ), –≥–æ—Ä–ª–æ (ÿßŸÑÿ≠ŸÑŸÇ), —è–∑—ã–∫ (ÿßŸÑŸÑÿ≥ÿßŸÜ), –≥—É–±—ã (ÿßŸÑÿ¥ŸÅÿ™ÿßŸÜ), –Ω–æ—Å–æ–≤–∞—è –ø–æ–ª–æ—Å—Ç—å (ÿßŸÑÿÆŸäÿ¥ŸàŸÖ).`,
    diagram: {"title": "–ö–∞—Ä—Ç–∞ –º–∞—Ö—Ä–∞–¥–∂–µ–π (—Å—Ö–µ–º–∞)", "steps": [{"k": "ÿßŸÑÿ¨ŸàŸÅ", "v": "–ø–æ–ª–æ—Å—Ç—å —Ä—Ç–∞ ‚Äî –±—É–∫–≤—ã –º–∞–¥–¥–∞"}, {"k": "ÿßŸÑÿ≠ŸÑŸÇ", "v": "–≥–æ—Ä–ª–æ ‚Äî 6 –±—É–∫–≤"}, {"k": "ÿßŸÑŸÑÿ≥ÿßŸÜ", "v": "—è–∑—ã–∫ ‚Äî –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –±—É–∫–≤"}, {"k": "ÿßŸÑÿ¥ŸÅÿ™ÿßŸÜ/ÿßŸÑÿÆŸäÿ¥ŸàŸÖ", "v": "–≥—É–±—ã/–Ω–æ—Å ‚Äî —á–∞—Å—Ç—å –ø—Ä–∞–≤–∏–ª –∏ –≥—É–Ω–Ω–∞"}]},
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ŸÇŸéÿßŸÑŸé", "note": "–ú–∞–¥–¥ (ÿß) ‚Äî –ø–æ–ª–æ—Å—Ç—å —Ä—Ç–∞ (ÿßŸÑÿ¨ŸàŸÅ)."}, {"arabic": "ÿ£Ÿéÿ≠ŸéÿØŸå", "note": "–•–∞–º–∑–∞ ‚Äî –≥–æ—Ä–ª–æ."}]}],
    quiz: [{"q": "–ú–∞—Ö—Ä–∞–¥–∂ ‚Äî —ç—Ç–æ‚Ä¶", "a": ["–∫–∞—á–µ—Å—Ç–≤–æ –±—É–∫–≤—ã", "–º–µ—Å—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è", "–≤–∏–¥ –º–∞–¥–¥–∞"], "c": 1, "e": "–ú–∞—Ö—Ä–∞–¥–∂ ‚Äî –º–µ—Å—Ç–æ (–≤—ã—Ö–æ–¥) –∑–≤—É–∫–∞."}, {"q": "–°–∫–æ–ª—å–∫–æ –±—É–∫–≤ —É –º–∞—Ö—Ä–∞–¥–∂–µ–π –≥–æ—Ä–ª–∞?", "a": ["4", "6", "8"], "c": 1, "e": "–ì–æ—Ä–ª–æ: 3 —á–∞—Å—Ç–∏ √ó 2 –±—É–∫–≤—ã = 6."}],
  },
  {
    id: "b1_02",
    block: "b1",
    order: 2,
    title: "–ì–æ—Ä–ª–æ (ÿßŸÑÿ≠ŸÑŸÇ): 3 —á–∞—Å—Ç–∏ –∏ 6 –±—É–∫–≤",
    tags: ["–≥–æ—Ä–ª–æ", "—Ö–∞–ª–∫", "—Ö–∞–º–∑–∞", "–∞–π–Ω"],
    text: `–ì–æ—Ä–ª–æ (ÿßŸÑÿ≠ŸÑŸÇ) –¥–µ–ª—è—Ç –Ω–∞ 3 —á–∞—Å—Ç–∏. –ò–∑ –∫–∞–∂–¥–æ–π –≤—ã—Ö–æ–¥—è—Ç 2 –±—É–∫–≤—ã (–≤—Å–µ–≥–æ 6).

1) –ì–ª—É–±–∏–Ω–∞ –≥–æ—Ä–ª–∞ (ÿ£ŸÇÿµŸâ ÿßŸÑÿ≠ŸÑŸÇ): ÿ° ŸáŸÄ
2) –°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç—å (Ÿàÿ≥ÿ∑ ÿßŸÑÿ≠ŸÑŸÇ): ÿπ ÿ≠
3) –ë–ª–∏–∂–Ω—è—è –∫ —Ä—Ç—É —á–∞—Å—Ç—å (ÿ£ÿØŸÜŸâ ÿßŸÑÿ≠ŸÑŸÇ): ÿ∫ ÿÆ

–≠—Ç–∏ –±—É–∫–≤—ã –≤–∞–∂–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –∏–∑—Ö–∞—Ä (ÿ•ÿ∏Ÿáÿßÿ±).`,
    diagram: {"title": "ÿßŸÑÿ≠ŸÑŸÇ ‚Äî 3 —Å—Ç—É–ø–µ–Ω–∏", "steps": [{"k": "ÿ£ŸÇÿµŸâ ÿßŸÑÿ≠ŸÑŸÇ", "v": "ÿ° ŸáŸÄ"}, {"k": "Ÿàÿ≥ÿ∑ ÿßŸÑÿ≠ŸÑŸÇ", "v": "ÿπ ÿ≠"}, {"k": "ÿ£ÿØŸÜŸâ ÿßŸÑÿ≠ŸÑŸÇ", "v": "ÿ∫ ÿÆ"}]},
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ÿ£ŸéÿÆŸéÿ∞Ÿé", "note": "ÿ° ‚Äî ÿ£ŸÇÿµŸâ ÿßŸÑÿ≠ŸÑŸÇ"}, {"arabic": "ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè", "note": "ÿ≠ ‚Äî Ÿàÿ≥ÿ∑ ÿßŸÑÿ≠ŸÑŸÇ"}, {"arabic": "ÿÆŸéŸäŸíÿ±Ÿå", "note": "ÿÆ ‚Äî ÿ£ÿØŸÜŸâ ÿßŸÑÿ≠ŸÑŸÇ"}]}],
  },
  {
    id: "b2_01",
    block: "b2",
    order: 1,
    title: "–°—ã—Ñ–∞—Ç—ã: –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)",
    tags: ["—Å—ã—Ñ–∞—Ç—ã", "—à–∏–¥–¥–∞", "–±–∞–π–Ω–∏—è", "—Ä–∞—Ö–∞–≤–∞", "–∏–∑–ª—è–∫", "–∏—Å–º–∞—Ç"],
    text: `–°—ã—Ñ–∞—Ç—ã (ÿµŸÅÿßÿ™) ‚Äî —Å–≤–æ–π—Å—Ç–≤–∞ –±—É–∫–≤: ¬´–∫–∞–∫¬ª –∑–≤—É—á–∏—Ç –±—É–∫–≤–∞.

–ï—Å—Ç—å –ø–∞—Ä–Ω—ã–µ (–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ) –∏ –Ω–µ–ø–∞—Ä–Ω—ã–µ.

–ü–∞—Ä–Ω—ã–µ –ø–∞—Ä—ã:
1) ŸáŸÖÿ≥ ‚Üî ÿ¨Ÿáÿ±
2) ÿ¥ÿØÿ© ‚Üî ÿ®ŸäŸÜŸäÿ©/ÿ™Ÿàÿ≥ÿ∑ ‚Üî ÿ±ÿÆÿßŸàÿ©
3) ÿßÿ≥ÿ™ÿπŸÑÿßÿ° ‚Üî ÿßÿ≥ÿ™ŸÅÿßŸÑ
4) ÿ•ÿ∑ÿ®ÿßŸÇ ‚Üî ÿßŸÜŸÅÿ™ÿßÿ≠
5) ÿ•ÿ∞ŸÑÿßŸÇ ‚Üî ÿ•ÿµŸÖÿßÿ™

–ù–µ–ø–∞—Ä–Ω—ã–µ —Å—ã—Ñ–∞—Ç—ã:
‚Ä¢ ÿµŸÅŸäÿ± ‚Ä¢ ŸÇŸÑŸÇŸÑÿ© ‚Ä¢ ÿ∫ŸÜÿ© ‚Ä¢ ÿ™ŸÉÿ±Ÿäÿ± ‚Ä¢ ÿ™ŸÅÿ¥Ÿä ‚Ä¢ ÿßÿ≥ÿ™ÿ∑ÿßŸÑÿ© ‚Ä¢ ÿßŸÜÿ≠ÿ±ÿßŸÅ

–î–∞–ª—å—à–µ ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ –ø–æ –∫–ª—é—á–µ–≤—ã–º –∏–∑ –Ω–∏—Ö —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏.`,
    extras: [{"type": "callout", "title": "–í–∞–∂–Ω–æ", "text": "–¢–µ—Ä–º–∏–Ω—ã: –®–∏–¥–¥–∞, –ë–∞–π–Ω–∏—è (–¢–∞–≤–∞—Å—Å—É—Ç), –†–∞—Ö–∞–≤–∞. –ü—è—Ç–∞—è –ø–∞—Ä–∞: –ò–∑–ª—è–∫—ä –∏ –ò—Å–º–∞—Ç."}, {"type": "arabic_examples", "items": [{"arabic": "ŸÇŸéÿØŸí ÿ£ŸéŸÅŸíŸÑŸéÿ≠Ÿé", "note": "ŸÇ/ÿØ ‚Äî –∫–∞–ª—å–∫–∞–ª—è –ø—Ä–∏ —Å—É–∫—É–Ω–µ."}, {"arabic": "ÿ•ŸêŸÜŸëŸéÿß", "note": "ŸÜŸë ‚Äî —Å–∏–ª—å–Ω–∞—è –≥—É–Ω–Ω–∞."}]}],
  },
  {
    id: "b2_02",
    block: "b2",
    order: 2,
    title: "–®–∏–¥–¥–∞ ‚Ä¢ –ë–∞–π–Ω–∏—è ‚Ä¢ –†–∞—Ö–∞–≤–∞ ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ",
    tags: ["—à–∏–¥–¥–∞", "–±–∞–π–Ω–∏—è", "—Ç–∞–≤–∞—Å—Å—É—Ç", "—Ä–∞—Ö–∞–≤–∞"],
    text: `–≠—Ç–∞ —Ç—Ä–æ–π–∫–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–µ–ø–µ–Ω—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è –≤–æ–∑–¥—É—Ö–∞.

‚Ä¢ ÿ¥ÿØÿ© (–®–∏–¥–¥–∞): –≤–æ–∑–¥—É—Ö –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Üí –∑–≤—É–∫ —Ä–µ–∑—á–µ.
‚Ä¢ ÿ®ŸäŸÜŸäÿ©/ÿ™Ÿàÿ≥ÿ∑ (–ë–∞–π–Ω–∏—è/–¢–∞–≤–∞—Å—Å—É—Ç): —Å—Ä–µ–¥–Ω–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ.
‚Ä¢ ÿ±ÿÆÿßŸàÿ© (–†–∞—Ö–∞–≤–∞): –ø–æ—Ç–æ–∫ –≤–æ–∑–¥—É—Ö–∞ —Å–≤–æ–±–æ–¥–Ω–µ–µ ‚Üí –∑–≤—É–∫ ¬´—Ç—è–Ω–µ—Ç—Å—è¬ª.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ÿ£Ÿéÿ™ŸíŸÇŸéŸÜŸé", "note": "ÿ™ ‚Äî –±–æ–ª–µ–µ ¬´–∂—ë—Å—Ç–∫–æ¬ª (—à–∏–¥–¥–∞)."}, {"arabic": "ŸÅŸêŸä", "note": "ŸÅ ‚Äî –±–ª–∏–∂–µ –∫ —Ä–∞—Ö–∞–≤–µ."}]}],
    quiz: [{"q": "–®–∏–¥–¥–∞ ‚Äî —ç—Ç–æ‚Ä¶", "a": ["–ø–æ–ª–Ω–æ–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –≤–æ–∑–¥—É—Ö–∞", "—Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ç–æ–∫ –≤–æ–∑–¥—É—Ö–∞", "—Å–∫—Ä—ã—Ç–∏–µ –Ω—É–Ω"], "c": 0, "e": "–®–∏–¥–¥–∞: –≤–æ–∑–¥—É—Ö –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é."}, {"q": "–°—Ä–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è‚Ä¶", "a": ["–ë–∞–π–Ω–∏—è (–¢–∞–≤–∞—Å—Å—É—Ç)", "–ò—Ö—Ñ–∞", "–ò–∫—ä–ª—è–±"], "c": 0, "e": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ë–∞–π–Ω–∏—è/–¢–∞–≤–∞—Å—Å—É—Ç."}],
  },
  {
    id: "b2_03",
    block: "b2",
    order: 3,
    title: "–ò–∑–ª—è–∫—ä –∏ –ò—Å–º–∞—Ç (ÿ•ÿ∞ŸÑÿßŸÇ / ÿ•ÿµŸÖÿßÿ™)",
    tags: ["–∏–∑–ª—è–∫", "–∏—Å–º–∞—Ç"],
    text: `–≠—Ç–æ –ø—è—Ç–∞—è –ø–∞—Ä–∞ —Å—ã—Ñ–∞—Ç–æ–≤.

‚Ä¢ ÿ•ÿ∞ŸÑÿßŸÇ (–ò–∑–ª—è–∫—ä): –ª—ë–≥–∫–æ—Å—Ç—å/¬´–ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç—å¬ª –ø—Ä–æ–∏–∑–Ω–µ—Å–µ–Ω–∏—è.
‚Ä¢ ÿ•ÿµŸÖÿßÿ™ (–ò—Å–º–∞—Ç): –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ.

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∑–∞–ø–æ–º–∏–Ω–∞–ª–∫–∞ –¥–ª—è –±—É–∫–≤ ÿ•ÿ∞ŸÑÿßŸÇ: ¬´ŸÅŸéÿ±ŸëŸé ŸÖŸêŸÜŸí ŸÑŸèÿ®Ÿë¬ª.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ŸÅŸéÿ±ŸëŸé ŸÖŸêŸÜŸí ŸÑŸèÿ®Ÿë", "note": "–§—Ä–∞–∑–∞-–ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –±—É–∫–≤ ÿ•ÿ∞ŸÑÿßŸÇ."}]}],
  },
  {
    id: "b3_01",
    block: "b3",
    order: 1,
    title: "–¢–∞–Ω—É–∏–Ω –∏–ª–∏ –Ω—É–Ω —Å —Å—É–∫—É–Ω–æ–º ‚Äî –æ—Å–Ω–æ–≤—ã",
    tags: ["—Ç–∞–Ω—É–∏–Ω", "–Ω—É–Ω", "—Å—É–∫—É–Ω", "–∏–∑—Ö–∞—Ä", "–∏–¥–≥–∞–º", "–∏–∫–ª—è–±", "–∏—Ö—Ñ–∞"],
    text: `–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã: ¬´–¢–∞–Ω—É–∏–Ω (ÿ™ŸÜŸàŸäŸÜ) –∏–ª–∏ –Ω—É–Ω —Å —Å—É–∫—É–Ω–æ–º (ŸÜŸàŸÜ ÿ≥ÿßŸÉŸÜÿ©)¬ª.

–¢–∞–Ω—É–∏–Ω: Ÿã Ÿç Ÿå.
–ù—É–Ω —Å —Å—É–∫—É–Ω–æ–º: ŸÜŸí.

–¢–µ—Ä–º–∏–Ω—ã –ø—Ä–∞–≤–∏–ª:
‚Ä¢ ÿ•ÿ∏Ÿáÿßÿ± (–ò–∑—Ö–∞—Ä)
‚Ä¢ ÿ•ÿØÿ∫ÿßŸÖ (–ò–¥–≥—ä–∞–º)
‚Ä¢ ÿ•ŸÇŸÑÿßÿ® (–ò–∫—ä–ª—è–±)
‚Ä¢ ÿ•ÿÆŸÅÿßÿ° (–ò—Ö—Ñ–∞)`,
    extras: [{"type": "callout", "title": "–ü–æ–¥—Å–∫–∞–∑–∫–∞", "text": "–ù–∏–∂–µ –∫–∞–∂–¥—ã–π —Ç–µ—Ä–º–∏–Ω ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–º —É—Ä–æ–∫–æ–º —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏."}],
  },
  {
    id: "b3_02",
    block: "b3",
    order: 2,
    title: "–ò–∑—Ö–∞—Ä (ÿ•ÿ∏Ÿáÿßÿ±) ‚Äî —è—Å–Ω–æ–µ –ø—Ä–æ–∏–∑–Ω–µ—Å–µ–Ω–∏–µ",
    tags: ["–∏–∑—Ö–∞—Ä"],
    text: `–ò–∑—Ö–∞—Ä ‚Äî —è—Å–Ω–æ–µ –ø—Ä–æ–∏–∑–Ω–µ—Å–µ–Ω–∏–µ –Ω—É–Ω —Å —Å—É–∫—É–Ω–æ–º/—Ç–∞–Ω—É–∏–Ω–∞ –±–µ–∑ —Å–ª–∏—è–Ω–∏—è.

–ë—É–∫–≤—ã –∏–∑—Ö–∞—Ä (–±—É–∫–≤—ã –≥–æ—Ä–ª–∞): ÿ° ŸáŸÄ ÿπ ÿ≠ ÿ∫ ÿÆ.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ŸÖŸéŸÜŸí ŸáŸéÿßÿØŸé", "note": "ŸÜŸí + ŸáŸÄ ‚Üí –∏–∑—Ö–∞—Ä"}, {"arabic": "ÿπŸéŸÑŸêŸäŸÖŸå ÿ≠ŸéŸÉŸêŸäŸÖŸå", "note": "—Ça–Ω—É–∏–Ω + ÿ≠ ‚Üí –∏–∑—Ö–∞—Ä"}]}],
    quiz: [{"q": "–ë—É–∫–≤—ã –∏–∑—Ö–∞—Ä –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫‚Ä¶", "a": ["—è–∑—ã–∫—É", "–≥–æ—Ä–ª—É", "–≥—É–±–∞–º"], "c": 1, "e": "–ò–∑—Ö–∞—Ä ‚Äî –ø–µ—Ä–µ–¥ –±—É–∫–≤–∞–º–∏ –≥–æ—Ä–ª–∞."}],
  },
  {
    id: "b3_03",
    block: "b3",
    order: 3,
    title: "–ò–¥–≥—ä–∞–º (ÿ•ÿØÿ∫ÿßŸÖ) ‚Äî —Å–ª–∏—è–Ω–∏–µ",
    tags: ["–∏–¥–≥–∞–º", "Ÿäÿ±ŸÖŸÑŸàŸÜ"],
    text: `–ò–¥–≥—ä–∞–º ‚Äî —Å–ª–∏—è–Ω–∏–µ –Ω—É–Ω —Å —Å—É–∫—É–Ω–æ–º/—Ç–∞–Ω—É–∏–Ω–∞ —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –±—É–∫–≤–æ–π.

–ß–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥—è—Ç –±—É–∫–≤—ã ¬´Ÿäÿ±ŸÖŸÑŸàŸÜ¬ª. –ü–æ–¥–≤–∏–¥—ã (—Å –≥—É–Ω–Ω–æ–π / –±–µ–∑ –≥—É–Ω–Ω—ã) ‚Äî –æ—Ñ–æ—Ä–º–∏–º —Å—Ç—Ä–æ–≥–æ –ø–æ —É—á–µ–±–Ω–∏–∫—É.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ŸÖŸêŸÜŸí ÿ±Ÿéÿ®ŸëŸêŸáŸêŸÖŸí", "note": "ŸÜŸí + ÿ± ‚Üí –∏–¥–≥—ä–∞–º"}, {"arabic": "ŸÖŸéŸÜŸí ŸäŸéŸÇŸèŸàŸÑŸè", "note": "ŸÜŸí + Ÿä ‚Üí –∏–¥–≥—ä–∞–º (—á–∞—Å—Ç–æ —Å –≥—É–Ω–Ω–æ–π)"}]}],
  },
  {
    id: "b3_04",
    block: "b3",
    order: 4,
    title: "–ò–∫—ä–ª—è–± (ÿ•ŸÇŸÑÿßÿ®) ‚Äî –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ ŸÖ",
    tags: ["–∏–∫–ª—è–±"],
    text: `–ò–∫—ä–ª—è–± ‚Äî –∫–æ–≥–¥–∞ ŸÜŸí –∏–ª–∏ —Ç–∞–Ω—É–∏–Ω –ø–µ—Ä–µ–¥ ÿ® –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ ¬´—Å–∫—Ä—ã—Ç—ã–π –º–∏–º¬ª —Å –≥—É–Ω–Ω–æ–π.

–í –º—É—Å—Ö–∞—Ñ–µ —á–∞—Å—Ç–æ —Å—Ç–∞–≤—è—Ç –º–∞–ª–µ–Ω—å–∫—É—é ŸÖ –∫–∞–∫ –ø–æ–¥—Å–∫–∞–∑–∫—É.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ÿ£ŸéŸÜŸíÿ®Ÿêÿ¶ŸíŸáŸèŸÖŸí", "note": "ŸÜŸí + ÿ® ‚Üí –∏–∫—ä–ª—è–±"}, {"arabic": "ÿ≥ŸéŸÖŸêŸäÿπŸå ÿ®ŸéÿµŸêŸäÿ±Ÿå", "note": "—Ça–Ω—É–∏–Ω + ÿ® ‚Üí –∏–∫—ä–ª—è–±"}]}],
  },
  {
    id: "b3_05",
    block: "b3",
    order: 5,
    title: "–ò—Ö—Ñ–∞ (ÿ•ÿÆŸÅÿßÿ°) ‚Äî —Å–∫—Ä—ã—Ç–∏–µ",
    tags: ["–∏—Ö—Ñ–∞"],
    text: `–ò—Ö—Ñ–∞ ‚Äî ¬´—Å—Ä–µ–¥–Ω–µ–µ¬ª —á—Ç–µ–Ω–∏–µ: –Ω—É–Ω/—Ç–∞–Ω—É–∏–Ω –Ω–µ –ø—Ä–æ–∏–∑–Ω–æ—Å—è—Ç—Å—è —è–≤–Ω–æ –∫–∞–∫ ŸÜ, –Ω–æ –∏ –Ω–µ —Å–ª–∏–≤–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é.

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≥—É–Ω–Ω–∞. –°–ø–∏—Å–æ–∫ –±—É–∫–≤ –∏—Ö—Ñ–∞ –¥–æ–±–∞–≤–∏–º —Ç–æ—á–Ω—ã–π –ø–æ —É—á–µ–±–Ω–∏–∫—É (–æ–±—ã—á–Ω–æ 15).`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ŸÖŸêŸÜŸí ÿ™Ÿéÿ≠Ÿíÿ™ŸêŸáŸéÿß", "note": "ŸÜŸí + ÿ™ ‚Üí –∏—Ö—Ñ–∞"}, {"arabic": "ŸÖŸêŸÜŸí ÿµŸèÿØŸèŸàÿ±Ÿê", "note": "–Ω—É–Ω –ø–µ—Ä–µ–¥ ÿµ ‚Äî –∏—Ö—Ñ–∞ (–ø—Ä–∏–º–µ—Ä)"}]}],
  },
  {
    id: "b4_01",
    block: "b4",
    order: 1,
    title: "–•–∞–º–∑–∞ –∏ –µ–≥–æ –≤–∏–¥—ã",
    tags: ["—Ö–∞–º–∑–∞", "ÿ£", "ÿ•", "ÿ§", "ÿ¶"],
    text: `–•–∞–º–∑–∞ (ÿ°) –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å—Å—è –ø–æ‚Äë—Ä–∞–∑–Ω–æ–º—É: –Ω–∞ –∞–ª–∏—Ñ (ÿ£/ÿ•), –Ω–∞ –≤–∞—É (ÿ§), –Ω–∞ –π–∞ (ÿ¶), –Ω–∞ —Å—Ç—Ä–æ–∫–µ (ÿ°).

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ —Å–æ–±–µ—Ä—ë–º –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏ —á—Ç–µ–Ω–∏—è —Å—Ç—Ä–æ–≥–æ –ø–æ —É—á–µ–±–Ω–∏–∫—É.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ÿ£Ÿé", "note": "—Ö–∞–º–∑–∞ –Ω–∞ –∞–ª–∏—Ñ"}, {"arabic": "ŸÖŸéÿ≥Ÿíÿ§ŸèŸàŸÑ", "note": "—Ö–∞–º–∑–∞ –Ω–∞ –≤–∞—É"}, {"arabic": "ÿ≥Ÿèÿ¶ŸêŸÑŸé", "note": "—Ö–∞–º–∑–∞ –Ω–∞ –π–∞"}]}],
  },
  {
    id: "b4_02",
    block: "b4",
    order: 2,
    title: "–¢–∞‚Äë–º–∞—Ä–±—É—Ç–∞ (ÿ©)",
    tags: ["—Ç–∞ –º–∞—Ä–±—É—Ç–∞", "ÿ©"],
    text: `–¢–∞‚Äë–º–∞—Ä–±—É—Ç–∞ (ÿ©) –ø—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ ÿ™, –∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ–±—ã—á–Ω–æ –∫–∞–∫ Ÿá (–ø–æ –ø—Ä–∞–≤–∏–ª–∞–º —É—á–µ–±–Ω–∏–∫–∞).

–î–æ–±–∞–≤–∏–º —Ç–∞–±–ª–∏—Ü—É —Å–ª—É—á–∞–µ–≤ –∏ –ø—Ä–∏–º–µ—Ä—ã.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿå", "note": "–ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ ‚Üí ÿ±ÿ≠ŸÖÿ©Ÿí"}, {"arabic": "ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿè ÿßŸÑŸÑŸëŸéŸáŸê", "note": "–ø—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ ‚Üí ÿ±ÿ≠ŸÖÿ©Ÿè"}]}],
  },
  {
    id: "b4_03",
    block: "b4",
    order: 3,
    title: "–ö–∞–ª—å–∫–∞–ª—è (ŸÇŸÑŸÇŸÑÿ©)",
    tags: ["–∫–∞–ª—å–∫–∞–ª—è", "ŸÇÿ∑ÿ® ÿ¨ÿØ"],
    text: `–ö–∞–ª—å–∫–∞–ª—è ‚Äî ¬´–æ—Ç—Å–∫–æ–∫¬ª –∑–≤—É–∫–∞ —É –±—É–∫–≤ ŸÇ ÿ∑ ÿ® ÿ¨ ÿØ –ø—Ä–∏ —Å—É–∫—É–Ω–µ.

–ù–∞ –∫–æ–Ω—Ü–µ —Å–ª–æ–≤–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ–Ω–∞ —Å–∏–ª—å–Ω–µ–µ.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ŸäŸéÿ¨ŸíÿπŸéŸÑŸí", "note": "ÿ¨Ÿí ‚Äî –∫–∞–ª—å–∫–∞–ª—è"}, {"arabic": "ÿßŸÑŸíÿ≠ŸéŸÇŸëŸè", "note": "ŸÇŸí –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ ‚Äî —Å–∏–ª—å–Ω–µ–µ"}]}],
  },
  {
    id: "b4_04",
    block: "b4",
    order: 4,
    title: "–í–∏–¥—ã —Å—É–∫—É–Ω–æ–≤",
    tags: ["—Å—É–∫—É–Ω", "–≤—Ä–µ–º–µ–Ω–Ω—ã–π", "–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π"],
    text: `–°—É–∫—É–Ω (Ÿí) ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–≥–ª–∞—Å–æ–≤–∫–∏.

–í —É—á–µ–±–Ω–∏–∫–∞—Ö —Ä–∞–∑–ª–∏—á–∞—é—Ç —Å—É–∫—É–Ω –Ω–∞—Å—Ç–æ—è—â–∏–π (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π) –∏ —Å—É–∫—É–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî –≤–∞q—Ñ).`,
  },
  {
    id: "b4_05",
    block: "b4",
    order: 5,
    title: "–ü–æ–ª–æ–∂–µ–Ω–∏–µ –±—É–∫–≤—ã ŸÑ—è–º (ŸÑ)",
    tags: ["–ª—è–º", "ŸÑ"],
    text: `–†–∞–∑–¥–µ–ª –ø—Ä–æ ŸÑ—è–º (ŸÑ): —Å–ª—É—á–∞–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ —á—Ç–µ–Ω–∏—è (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è, –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è —á–∞—Å—Ç–æ –≤ –ö–æ—Ä–∞–Ω–µ) ‚Äî –ø–æ —É—á–µ–±–Ω–∏–∫—É.

–î–æ–±–∞–≤–∏–º —Å—Ö–µ–º—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —Ç–≤–æ–µ–≥–æ –ø–æ—Å–æ–±–∏—è.`,
  },
  {
    id: "b4_06",
    block: "b4",
    order: 6,
    title: "–ü–æ–ª–æ–∂–µ–Ω–∏–µ –±—É–∫–≤—ã –º–∏–º (ŸÖ) –∏ –º–∏–º —Å —Å—É–∫—É–Ω–æ–º",
    tags: ["–º–∏–º", "–º–∏–º —Å —Å—É–∫—É–Ω–æ–º", "ŸÖŸäŸÖ ÿ≥ÿßŸÉŸÜÿ©"],
    text: `–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: ¬´–º–∏–º —Å —Å—É–∫—É–Ω–æ–º¬ª (ŸÖŸäŸÖ ÿ≥ÿßŸÉŸÜÿ©).

–ó–¥–µ—Å—å —Å–æ–±–µ—Ä—ë–º –ø—Ä–∞–≤–∏–ª–∞: –∏–∑—Ö–∞—Ä/–∏–¥–≥—ä–∞–º/–∏—Ö—Ñ–∞ –º–∏–º ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ –∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ (–∫–∞–∫ –≤ —É—á–µ–±–Ω–∏–∫–µ).`,
  },
  {
    id: "b4_07",
    block: "b4",
    order: 7,
    title: "–ü–æ–ª–æ–∂–µ–Ω–∏–µ –±—É–∫–≤—ã –Ω—É–Ω –∏ —Ç–∞–Ω—É–∏–Ω–∞ ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ",
    tags: ["–Ω—É–Ω", "—Ç–∞–Ω—É–∏–Ω"],
    text: `–°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è ŸÜ –∏ —Ç–∞–Ω—É–∏–Ω–∞ –≤ –æ–¥–Ω–æ–π –ª–æ–≥–∏–∫–µ: –∏–∑—Ö–∞—Ä, –∏–¥–≥—ä–∞–º, –∏–∫—ä–ª—è–±, –∏—Ö—Ñ–∞.

–î–æ–±–∞–≤–∏–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±—É–∫–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ —É—á–µ–±–Ω–∏–∫—É + –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã.`,
  },
  {
    id: "b4_08",
    block: "b4",
    order: 8,
    title: "–ü–æ–ª–æ–∂–µ–Ω–∏–µ –±—É–∫–≤—ã —Ä–æ (ÿ±)",
    tags: ["—Ä–æ", "ÿ±"],
    text: `–ë—É–∫–≤–∞ ÿ± –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è (—É—Ç–æ–ª—â–µ–Ω–∏–µ/—Å–º—è–≥—á–µ–Ω–∏–µ) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–≥–ª–∞—Å–æ–≤–æ–∫ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

–°—é–¥–∞ –¥–æ–±–∞–≤–∏–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∞–≤–∏–ª –∏ –ø—Ä–∏–º–µ—Ä—ã –ø–æ —É—á–µ–±–Ω–∏–∫—É.`,
  },
  {
    id: "b5_01",
    block: "b5",
    order: 1,
    title: "–ê–ª—å‚Äë–º–∞–¥–¥ (ÿßŸÑŸÖÿØŸë): –≤–∏–¥—ã —É–¥–ª–∏–Ω–µ–Ω–∏–π",
    tags: ["–º–∞–¥–¥", "—É–¥–ª–∏–Ω–µ–Ω–∏–µ", "ÿßŸÑŸÖÿØ"],
    text: `–ê–ª—å‚Äë–º–∞–¥–¥ ‚Äî —É–¥–ª–∏–Ω–µ–Ω–∏–µ –∑–≤—É–∫–∞.

–ë—É–∫–≤—ã –º–∞–¥–¥–∞: ÿß Ÿà Ÿä (–ø—Ä–∏ —É—Å–ª–æ–≤–∏—è—Ö).

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:
‚Ä¢ –º–∞–¥–¥ —Ç–∞–±–∏–∏ (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π)
‚Ä¢ —É–¥–ª–∏–Ω–µ–Ω–∏—è –ø–æ –ø—Ä–∏—á–∏–Ω–µ —Ö–∞–º–∑—ã
‚Ä¢ —É–¥–ª–∏–Ω–µ–Ω–∏—è –ø–æ –ø—Ä–∏—á–∏–Ω–µ —Å—É–∫—É–Ω–∞

–ù—É–∂–Ω—ã –≤—Å–µ –≤–∏–¥—ã –º–∞–¥–¥–æ–≤ ‚Äî –¥–æ–±–∞–≤–∏–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ —Ç–≤–æ–µ–≥–æ —É—á–µ–±–Ω–∏–∫–∞.`,
  },
  {
    id: "b5_02",
    block: "b5",
    order: 2,
    title: "–£–¥–ª–∏–Ω–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—á–∏–Ω–µ —Ö–∞–º–∑—ã",
    tags: ["–º–∞–¥–¥", "—Ö–∞–º–∑–∞", "ŸÖÿ™ÿµŸÑ", "ŸÖŸÜŸÅÿµŸÑ"],
    text: `–ö–æ–≥–¥–∞ —Ä—è–¥–æ–º —Å –±—É–∫–≤–æ–π –º–∞–¥–¥–∞ —Å—Ç–æ–∏—Ç —Ö–∞–º–∑–∞, –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —É–¥–ª–∏–Ω–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—á–∏–Ω–µ —Ö–∞–º–∑—ã.

–í–∏–¥—ã (–ø–æ —É—á–µ–±–Ω–∏–∫—É): ŸÖÿ™ÿµŸÑ, ŸÖŸÜŸÅÿµŸÑ –∏ –¥—Ä.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ÿ¨Ÿéÿßÿ°Ÿé", "note": "ŸÖÿ™ÿµŸÑ ‚Äî –≤ –æ–¥–Ω–æ–º —Å–ª–æ–≤–µ"}, {"arabic": "ŸÅŸêŸäŸì ÿ£ŸéŸÜŸíŸÅŸèÿ≥ŸêŸÉŸèŸÖŸí", "note": "ŸÖŸÜŸÅÿµŸÑ ‚Äî –≤ —Å–æ—Å–µ–¥–Ω–∏—Ö —Å–ª–æ–≤–∞—Ö"}]}],
  },
  {
    id: "b5_03",
    block: "b5",
    order: 3,
    title: "–£–¥–ª–∏–Ω–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—á–∏–Ω–µ —Å—É–∫—É–Ω–∞",
    tags: ["–º–∞–¥–¥", "—Å—É–∫—É–Ω", "ŸÑÿßÿ≤ŸÖ", "ÿπÿßÿ±ÿ∂"],
    text: `–ö–æ–≥–¥–∞ –ø–æ—Å–ª–µ –±—É–∫–≤—ã –º–∞–¥–¥–∞ —Å—Ç–æ–∏—Ç —Å—É–∫—É–Ω (–Ω–∞—Å—Ç–æ—è—â–∏–π –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π), –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —É–¥–ª–∏–Ω–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—á–∏–Ω–µ —Å—É–∫—É–Ω–∞.

–í–∏–¥—ã (–ø–æ —É—á–µ–±–Ω–∏–∫—É): ŸÑÿßÿ≤ŸÖ, ÿπÿßÿ±ÿ∂ ŸÑŸÑÿ≥ŸÉŸàŸÜ –∏ –¥—Ä.`,
    extras: [{"type": "arabic_examples", "items": [{"arabic": "ÿßŸÑÿ∂ŸëŸéÿßŸìŸÑŸëŸêŸäŸÜŸé", "note": "ŸÑÿßÿ≤ŸÖ ‚Äî —Å–∏–ª—å–Ω–æ–µ —É–¥–ª–∏–Ω–µ–Ω–∏–µ"}, {"arabic": "ÿßŸÑŸíÿπŸéÿßŸÑŸéŸÖŸêŸäŸÜŸé", "note": "ÿπÿßÿ±ÿ∂ ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"}]}],
  },
  {
    id: "b6_01",
    block: "b6",
    order: 1,
    title: "–í–∞–∫—Ñ –∏ –∏–±—Ç–∏–¥–∞",
    tags: ["–≤–∞–∫—Ñ", "–∏–±—Ç–∏–¥–∞", "–æ—Å—Ç–∞–Ω–æ–≤–∫–∞"],
    text: `–í–∞–∫—Ñ ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞, –∏–±—Ç–∏–¥–∞ ‚Äî –Ω–∞—á–∞–ª–æ —á—Ç–µ–Ω–∏—è.

–†–∞–∑–±–µ—Ä—ë–º –ø—Ä–∞–≤–∏–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á—Ç–µ–Ω–∏—è, —á—Ç–æ–±—ã —Å–º—ã—Å–ª –Ω–µ –∏—Å–∫–∞–∂–∞–ª—Å—è.`,
    extras: [{"type": "callout", "title": "–¢—Ä–µ–Ω–∞–∂—ë—Ä", "text": "–í –∫–æ–Ω—Ü–µ –±–ª–æ–∫–∞ –µ—Å—Ç—å —ç–∫–∑–∞–º–µ–Ω –∏ —Ç—Ä–µ–Ω–∞–∂—ë—Ä ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞–∑."}],
  },
  {
    id: "b6_02",
    block: "b6",
    order: 2,
    title: "–ó–Ω–∞—á–∫–∏ –≤ –ö–æ—Ä–∞–Ω–µ",
    tags: ["–∑–Ω–∞—á–∫–∏", "–º—É—Å—Ö–∞—Ñ"],
    text: `–ó–Ω–∞—á–∫–∏ –≤ –º—É—Å—Ö–∞—Ñ–µ –ø–æ–º–æ–≥–∞—é—Ç —á—Ç–µ–Ω–∏—é (–≤ —Ç–æ–º —á–∏—Å–ª–µ –∑–Ω–∞–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∞–≤–∏–ª).

–î–æ–±–∞–≤–∏–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–Ω–∞—á–∫–æ–≤ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ —É—á–µ–±–Ω–∏–∫—É.`,
  },
];

// ==========================
// State
// ==========================
const LS_DONE="tajweed_done_v18";
const LS_EXAM="tajweed_exams_v18";
const LS_SETTINGS="tajweed_settings_v19";
const done=new Set(JSON.parse(localStorage.getItem(LS_DONE)||"[]"));
const exams=JSON.parse(localStorage.getItem(LS_EXAM)||"{}");
let settings=JSON.parse(localStorage.getItem(LS_SETTINGS)||"{}");

const el=id=>document.getElementById(id);
function blockLabel(b){
  return ({
    b1:"–ë–ª–æ–∫ 1: –ú–∞—Ö—Ä–∞–¥–∂–∏",
    b2:"–ë–ª–æ–∫ 2: –°—ã—Ñ–∞—Ç—ã",
    b3:"–ë–ª–æ–∫ 3: –ù—É–Ω ÿ≥ÿß–∫–∏–Ω–∞",
    b4:"–ë–ª–æ–∫ 4: –î–æ–ø. –ø—Ä–∞–≤–∏–ª–∞ –∏ –±—É–∫–≤—ã",
    b5:"–ë–ª–æ–∫ 5: –ú–∞–¥–¥—ã",
    b6:"–ë–ª–æ–∫ 6: –í–∞–∫—Ñ –∏ –∏–±—Ç–∏–¥–∞",
    trainer:"–¢—Ä–µ–Ω–∞–∂—ë—Ä",
    exam:"–≠–∫–∑–∞–º–µ–Ω—ã"
  })[b]||"–£—Ä–æ–∫";
}
function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function examBadge(id){
  const e=exams[id];
  if(!e) return "üìù";
  return e.passed ? `<span class="good">üèÅ ${Math.round(e.score*100)}%</span>` : `<span class="bad">üìù ${Math.round(e.score*100)}%</span>`;
}

// sorted list for navigation
const ordered = [...lessons].sort((a,b)=>(a.order||0)-(b.order||0));

// ==========================
// Render list
// ==========================
function render(){
  el("progressPill").textContent=`${done.size}/${lessons.length}`;

  const q=(el("q").value||"").trim().toLowerCase();
  const bf=el("blockFilter").value;

  const filtered = ordered.filter(l=>{
    if(bf!=="all"){
      if(bf==="exam"){ if(l.block!=="exam") return false; }
      else if(bf==="trainer"){ if(l.block!=="trainer") return false; }
      else if(l.block!==bf) return false;
    }
    if(!q) return true;
    const hay=(l.title+" "+(l.tags||[]).join(" ")+" "+(l.text||"")).toLowerCase();
    return hay.includes(q);
  });

  el("lessonList").innerHTML = filtered.map(l=>{
    const isExam = l.block==="exam";
    const isTrainer = l.block==="trainer";
    const badge = isExam ? examBadge(l.id) : (isTrainer ? "üéØ" : (done.has(l.id) ? "‚úÖ" : "‚¨ú"));
    return `
      <div class="card" style="margin:0;">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:900">${escapeHtml(l.title)} ${badge}</div>
            <div class="muted small">${escapeHtml(blockLabel(l.block))}</div>
          </div>
          <button class="primary" onclick="openLesson('${l.id}')">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
    `;
  }).join("");
}

// ==========================
// Lesson view
// ==========================
let currentId=null;

function openLesson(id){
  const idx = ordered.findIndex(x=>x.id===id);
  if(idx<0) return;
  currentId=id;

  const l=ordered[idx];
  el("viewHome").style.display="none";
  el("viewLesson").style.display="block";

  el("lessonTitle").textContent=l.title;
  el("lessonText").textContent=l.text||"";
  el("lessonBadges").innerHTML =
    `<span class="tag">${escapeHtml(blockLabel(l.block))}</span>` +
    (l.tags||[]).slice(0,10).map(t=>`<span class="tag">#${escapeHtml(t)}</span>`).join(" ");

  // prev/next
  const prev = idx>0 ? ordered[idx-1].id : null;
  const next = idx<ordered.length-1 ? ordered[idx+1].id : null;
  el("prevBtn").disabled = !prev;
  el("nextBtn").disabled = !next;
  el("prevBtn").onclick = ()=> prev && openLesson(prev);
  el("nextBtn").onclick = ()=> next && openLesson(next);

  // extras
  renderExtras(l.extras||[]);

  // diagram
  renderDiagram(l.diagram);

  // action button + quiz/trainer/exam
  const btn=el("btnDone");
  if(l.block==="exam"){
    const e=exams[id];
    btn.textContent = e?.passed ? `–≠–∫–∑–∞–º–µ–Ω —Å–¥–∞–Ω (${Math.round(e.score*100)}%)` : (e ? `–ü–µ—Ä–µ—Å–¥–∞—Ç—å (–ø–æ—Å–ª–µ–¥–Ω–∏–π ${Math.round(e.score*100)}%)` : "–ù–∞—á–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω");
    btn.onclick=()=>startExam(l);
    el("quizBlock").style.display="none"; el("quizBlock").innerHTML="";
  } else if(l.block==="trainer" || l.trainer){
    btn.textContent="–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–µ–Ω–∞–∂—ë—Ä";
    btn.onclick=()=>renderTrainer();
    el("quizBlock").style.display="none"; el("quizBlock").innerHTML="";
  } else {
    btn.textContent = done.has(id) ? "–°–Ω—è—Ç—å ¬´–ø—Ä–æ–π–¥–µ–Ω–æ¬ª" : "–û—Ç–º–µ—Ç–∏—Ç—å ¬´–ø—Ä–æ–π–¥–µ–Ω–æ¬ª";
    btn.onclick=()=>{
      if(done.has(id)) done.delete(id); else done.add(id);
      localStorage.setItem(LS_DONE, JSON.stringify([...done]));
      openLesson(id);
      render();
    };
    renderQuiz(l.quiz||[], {mode:"mini"});
  }
  // Notes (per lesson)
  const notesKey = "tajweed_note_" + id;
  const notesArea = el("notesArea");
  const clearNotesBtn = el("clearNotesBtn");
  const notesStatus = el("notesStatus");
  if(notesArea){
    notesArea.value = (localStorage.getItem(notesKey) || "");
    let t=null;
    notesArea.oninput = ()=>{
      if(notesStatus) notesStatus.textContent="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ‚Ä¶";
      clearTimeout(t);
      t=setTimeout(()=>{
        localStorage.setItem(notesKey, notesArea.value);
        if(notesStatus) notesStatus.textContent="–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ";
        updateNotesCount();
      }, 250);
    };
  }
  if(clearNotesBtn){
    clearNotesBtn.onclick=()=>{
      if(notesArea) notesArea.value="";
      localStorage.removeItem(notesKey);
      if(notesStatus) notesStatus.textContent="–û—á–∏—â–µ–Ω–æ";
      updateNotesCount();
    };
  }

}

function renderExtras(extras){
  const host = el("lessonExtras");
  host.innerHTML="";
  if(!extras.length) return;
  extras.forEach(x=>{
    if(x.type==="callout"){
      host.innerHTML += `<div class="notice"><b>${escapeHtml(x.title||"–í–∞–∂–Ω–æ")}</b><br/>${escapeHtml(x.body||"")}</div>`;
    }
    if(x.type==="arabic_examples"){
      const items=(x.items||[]).map(it=>`
        <div class="arline">
          <div class="ar">${it.ar}</div>
          <div class="muted small">${escapeHtml(it.note||"")}</div>
        </div>
      `).join("");
      host.innerHTML += `<div class="hr"></div><h3>${escapeHtml(x.title||"–ü—Ä–∏–º–µ—Ä—ã")}</h3>${items}`;
    }
  });
}

// ==========================
// Diagram
// ==========================
function renderDiagram(d){
  const t=el("lessonDiagram");
  if(!d){ t.innerHTML=""; return; }
  const steps=(d.steps||[]).map((s,i)=>`
    <div class="box">
      <div style="font-weight:900">${escapeHtml(s.t)}</div>
      <div class="muted small">${escapeHtml(s.d||"")}</div>
    </div>
    ${i<d.steps.length-1?`<div class="arrow">‚ûú</div>`:""}
  `).join("");
  t.innerHTML = `
    <div class="diagram">
      <div class="title">${escapeHtml(d.title||"–°—Ö–µ–º–∞")}</div>
      <div class="flow">${steps}</div>
    </div>
  `;
}

// ==========================
// Quiz Engine
// ==========================
function renderQuiz(qs, opts){
  const qb=el("quizBlock");
  if(!qs.length){ qb.style.display="none"; qb.innerHTML=""; return; }
  qb.style.display="block";

  qb.innerHTML = `
    <h3>${opts?.mode==="exam" ? "–≠–∫–∑–∞–º–µ–Ω" : "–ú–∏–Ω–∏‚Äë—Ç–µ—Å—Ç"}</h3>
    <div class="muted small">${opts?.mode==="exam" ? "–í—ã–±–µ—Ä–∏ –æ—Ç–≤–µ—Ç—ã –∏ –Ω–∞–∂–º–∏ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å¬ª." : "–ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å."}</div>
    <div class="hr"></div>
    <div id="qs"></div>
    <div class="hr"></div>
    <div class="row">
      <button class="primary" id="checkBtn">${opts?.mode==="exam" ? "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å" : "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"}</button>
      <button class="ghost" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
      <span class="right"></span>
      <span class="pill" id="scorePill" style="display:none"></span>
    </div>
    <div id="note" style="margin-top:10px;"></div>
  `;

  const qsEl=document.getElementById("qs");
  qsEl.innerHTML = qs.map((x,idx)=>`
    <div class="q">
      <div style="font-weight:900">${escapeHtml(x.q)}</div>
      ${(x.a||[]).map((v,j)=>`
        <label class="opt">
          <input type="radio" name="q${idx}" value="${j}"/>
          <span>${escapeHtml(v)}</span>
        </label>
      `).join("")}
      <div class="muted small" id="fb${idx}"></div>
    </div>
  `).join("");

  const scorePill=document.getElementById("scorePill");
  document.getElementById("resetBtn").onclick=()=>{
    qs.forEach((_,idx)=>{
      document.querySelectorAll(`input[name="q${idx}"]`).forEach(r=>r.checked=false);
      const fb=document.getElementById(`fb${idx}`);
      fb.textContent=""; fb.className="muted small";
    });
    scorePill.style.display="none";
    document.getElementById("note").innerHTML="";
  };

  document.getElementById("checkBtn").onclick=()=>{
    let correct=0;
    qs.forEach((x,idx)=>{
      const sel=document.querySelector(`input[name="q${idx}"]:checked`);
      const fb=document.getElementById(`fb${idx}`);
      if(!sel){
        fb.textContent="–û—Ç–≤–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω.";
        fb.className="muted small";
        return;
      }
      const choice=parseInt(sel.value,10);
      if(choice===x.c){
        correct++;
        fb.textContent="–í–µ—Ä–Ω–æ ‚úÖ";
        fb.className="muted small good";
      } else {
        fb.textContent=`–ù–µ–≤–µ—Ä–Ω–æ ‚ùå (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: ${escapeHtml(x.a[x.c])})`;
        fb.className="muted small bad";
      }
    });

    const score=correct/qs.length;
    scorePill.style.display="inline-block";
    scorePill.textContent=`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${correct}/${qs.length} (${Math.round(score*100)}%)`;

    if(opts?.mode==="exam"){
      opts.onFinish?.(score);
    }
  };
}

function startExam(lesson){
  const pass=typeof lesson.pass==="number" ? lesson.pass : 0.7;
  renderQuiz(lesson.quiz||[], {
    mode:"exam",
    onFinish:(score)=>{
      const passed=score>=pass;
      exams[lesson.id]={score, passed, ts: Date.now()};
      localStorage.setItem(LS_EXAM, JSON.stringify(exams));
      const note=document.getElementById("note");
      note.innerHTML = passed
        ? `<div class="notice good"><b>–≠–∫–∑–∞–º–µ–Ω —Å–¥–∞–Ω ‚úÖ</b><br/>${Math.round(score*100)}% (–ø—Ä–æ—Ö–æ–¥–Ω–æ–π ${Math.round(pass*100)}%).</div>`
        : `<div class="notice bad"><b>–ü–æ–∫–∞ –Ω–µ —Å–¥–∞–Ω ‚ùå</b><br/>${Math.round(score*100)}% (–Ω—É–∂–Ω–æ ${Math.round(pass*100)}%).</div>`;
      render();
    }
  });
}

// ==========================
// Trainer (mix of topics; will expand later per textbook)
// ==========================
function renderTrainer(){
  const qb=el("quizBlock");
  qb.style.display="block";
  qb.innerHTML = `
    <h3>üéØ –¢—Ä–µ–Ω–∞–∂—ë—Ä</h3>
    <div class="muted small">–í—ã–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ. –ú–æ–∂–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.</div>
    <div class="hr"></div>
    <div class="q">
      <div class="muted small">–°–∏—Ç—É–∞—Ü–∏—è</div>
      <div style="font-weight:900;font-size:18px" id="tPrompt"></div>
      <div class="hr"></div>
      <div class="muted small">–í—ã–±–µ—Ä–∏ –æ—Ç–≤–µ—Ç</div>
      <div id="tOptions"></div>
      <div class="hr"></div>
      <div class="row">
        <button class="primary" id="tCheck">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <button class="ghost" id="tNext">–°–ª–µ–¥—É—é—â–∏–π</button>
        <span class="right"></span>
        <span class="pill" id="tScore">0 –≤–µ—Ä–Ω–æ</span>
      </div>
      <div id="tFeedback" class="muted small" style="margin-top:10px"></div>
    </div>
  `;

  const tasks = [
    {p:"–©–∏–¥–¥–∞/–ë–∞–π–Ω–∏—è/–†–∞—Ö–∞–≤–∞: –±—É–∫–≤—ã ŸÑ ŸÜ ÿπ ŸÖ ÿ±", ok:"–ë–∞–π–Ω–∏—è", opts:["–©–∏–¥–¥–∞","–ë–∞–π–Ω–∏—è","–†–∞—Ö–∞–≤–∞"]},
    {p:"–•–∞–º—Å: ŸÅ ÿ≠ ÿ´ Ÿá ÿ¥ ÿÆ ÿµ ÿ≥ ŸÉ ÿ™", ok:"–•–∞–º—Å", opts:["–î–∂–∞—Ö—Ä","–•–∞–º—Å","–ö–∞–ª—å–∫–∞–ª—è"]},
    {p:"–ò—Å—Ç–∏‚Äò–ª—è: ÿÆ ÿµ ÿ∂ ÿ∫ ÿ∑ ŸÇ ÿ∏", ok:"–ò—Å—Ç–∏‚Äò–ª—è", opts:["–ò—Å—Ç–∏—Ñ–∞–ª—å","–ò—Ç–±–∞–∫","–ò—Å—Ç–∏‚Äò–ª—è"]},
    {p:"–ö–∞–ª—å–∫–∞–ª—è: ŸÇ ÿ∑ ÿ® ÿ¨ ÿØ", ok:"–ö–∞–ª—å–∫–∞–ª—è", opts:["–°–∞—Ñ–∏—Ä","–ö–∞–ª—å–∫–∞–ª—è","–õ–µ–π–Ω"]},
    {p:"ŸÖŸí + ŸÖ", ok:"–ò–¥–≥–∞–º –º–∏—Å–ª–µ–π–Ω", opts:["–ò—Ö—Ñ–∞ —à–∞—Ñ–∞—É–∏","–ò–¥–≥–∞–º –º–∏—Å–ª–µ–π–Ω","–ò–∑—Ö–∞—Ä"]},
    {p:"ŸÜŸí + ÿ®", ok:"–ò–∫–ª—è–±", opts:["–ò–∑—Ö–∞—Ä","–ò–∫–ª—è–±","–ò—Ö—Ñ–∞"]},
    {p:"–ó–Ω–∞–∫ –≤–∞–∫—Ñ–∞ ŸÑÿß", ok:"–ù–µ–ª—å–∑—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è", opts:["–ú–æ–∂–Ω–æ","–ù–µ–ª—å–∑—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è","–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"]},
    {p:"–ú–∞–¥–¥ —Ç–∞–±–∏–∏", ok:"2 —Ö–∞—Ä–∞–∫–∞—Ç–∞", opts:["2 —Ö–∞—Ä–∞–∫–∞—Ç–∞","4‚Äì5","6"]},
  ];

  let i = Math.floor(Math.random()*tasks.length);
  let correctCount = 0;

  const promptEl=document.getElementById("tPrompt");
  const optsEl=document.getElementById("tOptions");
  const fbEl=document.getElementById("tFeedback");
  const scoreEl=document.getElementById("tScore");

  function show(){
    fbEl.textContent="";
    const t=tasks[i];
    promptEl.textContent=t.p;
    optsEl.innerHTML = t.opts.map((o,idx)=>`
      <label class="opt">
        <input type="radio" name="tr" value="${idx}"/>
        <span>${escapeHtml(o)}</span>
      </label>
    `).join("");
  }

  function next(){
    i = (i+1) % tasks.length;
    show();
  }

  document.getElementById("tCheck").onclick=()=>{
    const t=tasks[i];
    const sel=document.querySelector('input[name="tr"]:checked');
    if(!sel){ fbEl.textContent="–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç üôÇ"; return; }
    const choice=t.opts[parseInt(sel.value,10)];
    if(choice===t.ok){
      correctCount++;
      fbEl.innerHTML=`<span class="good">–í–µ—Ä–Ω–æ ‚úÖ</span>`;
      scoreEl.textContent=`${correctCount} –≤–µ—Ä–Ω–æ`;
    } else {
      fbEl.innerHTML=`<span class="bad">–ù–µ–≤–µ—Ä–Ω–æ ‚ùå</span> –ü—Ä–∞–≤–∏–ª—å–Ω–æ: <b>${escapeHtml(t.ok)}</b>`;
    }
  };
  document.getElementById("tNext").onclick=()=>next();

  show();
}

// ==========================
// Navigation
// ==========================
function goHome(){
  el("viewLesson").style.display="none";
  el("viewHome").style.display="block";
 function applySettings(){
  const fs=settings.fs ?? 16;
  const ar=settings.ar ?? 1.25;
  const font=settings.arFont ?? `"Amiri","Scheherazade New","Noto Naskh Arabic","Noto Sans Arabic","Arial"`;
  document.documentElement.style.setProperty("--fs", fs+"px");
  document.documentElement.style.setProperty("--arabic-size", ar+"em");
  document.documentElement.style.setProperty("--arabic-font", font);

  // sync UI if exists
  const fsR=document.getElementById("fsRange"); if(fsR) fsR.value=fs;
  const arR=document.getElementById("arRange"); if(arR) arR.value=ar;
  const fsV=document.getElementById("fsVal"); if(fsV) fsV.textContent=fs;
  const arV=document.getElementById("arVal"); if(arV) arV.textContent=ar.toFixed(2)+"em";
  const sel=document.getElementById("arFontSel"); if(sel) sel.value=font;
  localStorage.setItem(LS_SETTINGS, JSON.stringify(settings));
  applyBackground();
  updateNotesCount();

}const arR=document.getElementById("arRange"); if(arR) arR.value=ar;
  const fsV=document.getElementById("fsVal"); if(fsV) fsV.textContent=fs;
  const arV=document.getElementById("arVal"); if(arV) arV.textContent=ar.toFixed(2)+"em";
  const sel=document.getElementById("arFontSel"); if(sel) sel.value=font;
  localStorage.setItem(LS_SETTINGS, JSON.stringify(settings));
}

function updateNotesCount(){
  try{
    const keys = Object.keys(localStorage).filter(k=>k.startsWith("tajweed_note_"));
    const elCount = el("notesCount");
    if(elCount) elCount.textContent = `–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∑–∞–º–µ—Ç–æ–∫: ${keys.length}`;
  }catch(e){}
}

function applyBackground(){
  const bg = (settings.bg || "stars");
  const customUrl = (settings.bgUrl || "").trim();

  // lightweight SVG patterns (arabic-style)
  const arabesqueSvg = encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" width="260" height="260" viewBox="0 0 260 260">
      <rect width="260" height="260" fill="transparent"/>
      <g fill="none" stroke="rgba(232,200,120,0.18)" stroke-width="2">
        <path d="M130 10c40 0 70 30 70 70s-30 70-70 70-70-30-70-70 30-70 70-70z"/>
        <path d="M130 50c18 0 32 14 32 32s-14 32-32 32-32-14-32-32 14-32 32-32z"/>
        <path d="M10 130c0-40 30-70 70-70s70 30 70 70-30 70-70 70-70-30-70-70z"/>
        <path d="M250 130c0-40-30-70-70-70s-70 30-70 70 30 70 70 70 70-30 70-70z"/>
        <path d="M130 250c-40 0-70-30-70-70s30-70 70-70 70 30 70 70-30 70-70 70z"/>
      </g>
    </svg>
  `.trim());

  const paperSvg = encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 400 400">
      <filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".9" numOctaves="2" stitchTiles="stitch"/></filter>
      <rect width="400" height="400" filter="url(#n)" opacity=".25" fill="#e8c878"/>
    </svg>
  `.trim());

  let img = "none";
  let repeat = "repeat";
  let size = "auto";

  if(bg==="stars"){
    img = "none";
  }else if(bg==="arabesque"){
    img = `url("data:image/svg+xml,${arabesqueSvg}")`;
    repeat = "repeat";
    size = "260px 260px";
  }else if(bg==="paper"){
    img = `url("data:image/svg+xml,${paperSvg}")`;
    repeat = "repeat";
    size = "400px 400px";
  }else if(bg==="custom" && customUrl){
    img = `url("${customUrl.replace(/"/g,'\\"')}")`;
    repeat = "no-repeat";
    size = "cover";
  }

  document.documentElement.style.setProperty("--bg-img", img);
  document.documentElement.style.setProperty("--bg-repeat", repeat);
  document.documentElement.style.setProperty("--bg-size", size);

  // sync UI if present
  const bgSel = el("bgSel");
  const bgUrlWrap = el("bgUrlWrap");
  const bgUrl = el("bgUrl");
  if(bgSel && bgSel.value !== bg) bgSel.value = bg;
  if(bgUrl){
    if(bgUrl.value !== customUrl) bgUrl.value = customUrl;
  }
  if(bgUrlWrap){
    bgUrlWrap.style.display = (bg==="custom") ? "block" : "none";
  }
}

applySettings();

const drawer=el("settingsDrawer");
el("settingsBtn").onclick=()=>drawer.classList.add("open");
el("closeSettings").onclick=()=>drawer.classList.remove("open");

el("fsRange").addEventListener("input",(e)=>{settings.fs=parseInt(e.target.value,10); applySettings();});
el("arRange").addEventListener("input",(e)=>{settings.ar=parseFloat(e.target.value); applySettings();});
el("arFontSel").addEventListener("change",(e)=>{settings.arFont=e.target.value; applySettings();});
el("resetSettings").onclick=()=>{settings={}; applySettings();};

// Background selection
const bgSelEl = el("bgSel");
if(bgSelEl){
  bgSelEl.addEventListener("change",(e)=>{settings.bg=e.target.value; applySettings();});
}
const bgUrlEl = el("bgUrl");
if(bgUrlEl){
  bgUrlEl.addEventListener("input",(e)=>{settings.bgUrl=e.target.value; applySettings();});
}

// Notes export / clear
const exportBtn = el("exportNotes");
if(exportBtn){
  exportBtn.onclick=()=>{
    const notes = {};
    Object.keys(localStorage).filter(k=>k.startsWith("tajweed_note_")).forEach(k=>{
      notes[k.replace("tajweed_note_","")] = localStorage.getItem(k) || "";
    });
    const payload = { exportedAt: new Date().toISOString(), notes };
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "tajweed-notes.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1500);
  };
}
const clearAllBtn = el("clearAllNotes");
if(clearAllBtn){
  clearAllBtn.onclick=()=>{
    if(!confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ?")) return;
    Object.keys(localStorage).filter(k=>k.startsWith("tajweed_note_")).forEach(k=>localStorage.removeItem(k));
    updateNotesCount();
    const na = el("notesArea");
    if(na) na.value="";
  };
}


// ==========================
// Initial render + PWA
// ==========================
el("q").addEventListener("input",render);
el("blockFilter").addEventListener("change",render);
render();

let dp=null;
window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();dp=e;el("installBtn").style.display="inline-block"});
el("installBtn").onclick=async()=>{if(!dp)return;dp.prompt();await dp.userChoice;dp=null;el("installBtn").style.display="none"};
if("serviceWorker" in navigator){navigator.serviceWorker.register("./sw.js")}
</script>
</body>
</html>
